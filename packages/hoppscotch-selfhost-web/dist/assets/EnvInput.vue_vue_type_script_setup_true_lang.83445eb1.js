import{f as M,j as y,X as g,V as T,g as O,ah as S,aR as D,o as H,d as K,e as k,N,m as j,aJ as A,bX as V,bf as w,b3 as J}from"./index.d0a044cd.js";import{H as P,E as u,d as x,i as R,t as I,p as L,V as X,h as _,k as z,e as F,f as E}from"./utils.a018fd3f.js";const U={class:"relative flex items-center flex-1 flex-shrink-0 py-4 overflow-auto whitespace-nowrap"},$={class:"absolute inset-0 flex flex-1"},q=["placeholder"],Y=M({__name:"EnvInput",props:{modelValue:{default:""},placeholder:{default:""},styles:{default:""},envs:{default:null},focus:{type:Boolean,default:!1},selectTextOnMount:{type:Boolean},environmentHighlights:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","change","paste","enter","keyup","keydown","click"],setup(d,{emit:s}){const l=d,c=y(l.modelValue),o=y(),r=y(null);g(()=>l.modelValue,a=>{var i,n;const t=a.replaceAll(`
`,""),e=(i=o.value)==null?void 0:i.state.doc.toJSON().join(o.value.state.lineBreak);(c.value!==t||a!==e)&&(c.value=t,(n=o.value)==null||n.dispatch({filter:!1,changes:{from:0,to:o.value.state.doc.length,insert:t}}))},{immediate:!0,flush:"sync"});let p=null,v=null;const b=T(A,[]),B=O(()=>l.envs?l.envs.map(a=>({key:a.key,value:a.value,sourceEnv:a.source})):b.value),C=new P(B,o),m=a=>{const t=[u.contentAttributes.of({"aria-label":l.placeholder}),u.updateListener.of(e=>{l.readonly&&(e.view.contentDOM.inputMode="none")}),x.changeFilter.of(()=>!l.readonly),R,l.readonly?u.theme({".cm-content":{caretColor:"var(--secondary-dark-color)",color:"var(--secondary-dark-color)",backgroundColor:"var(--divider-color)",opacity:.25}}):u.theme({}),I({position:"absolute"}),l.environmentHighlights?C:[],L(l.placeholder),u.domEventHandlers({paste(e){var i,n;p=e,v=(n=(i=e.clipboardData)==null?void 0:i.getData("text"))!=null?n:""},drop(e){e.preventDefault()}}),X.fromClass(class{update(e){if(!l.readonly&&e.docChanged){const i=V(c.value);c.value=e.state.doc.toJSON().join(e.state.lineBreak);const n=V(c.value).replaceAll(`
`,"");if(s("update:modelValue",n),s("change",n),!!e.transactions.find(f=>f.isUserEvent("input.paste"))&&p){const f=v;w(()=>{s("paste",{pastedValue:f,prevValue:i})})}else p=null,v=null}}}),_(),z.of([...F])];o.value=new u({parent:a,state:x.create({doc:l.modelValue,extensions:t})})},h=()=>{w(()=>{var a,t;(a=o.value)==null||a.focus(),(t=o.value)==null||t.dispatch({selection:E.create([E.range(0,l.modelValue.length)])})})};return S(()=>{var a,t;r.value&&(o.value||m(r.value),l.selectTextOnMount&&h(),(t=(a=D.ui)==null?void 0:a.onCodemirrorInstanceMount)==null||t.call(a,r.value))}),g(r,()=>{var a;r.value?(o.value||m(r.value),l.selectTextOnMount&&h()):((a=o.value)==null||a.destroy(),o.value=void 0)}),(a,t)=>(H(),K("div",U,[k("div",$,[k("div",{ref_key:"editor",ref:r,placeholder:d.placeholder,class:N(["flex flex-1",d.styles]),onKeydown:[t[0]||(t[0]=j(J(e=>s("enter",e),["prevent"]),["enter"])),t[3]||(t[3]=e=>s("keydown",e))],onKeyup:t[1]||(t[1]=e=>s("keyup",e)),onClick:t[2]||(t[2]=e=>s("click",e))},null,42,q)])]))}});export{Y as _};
//# sourceMappingURL=EnvInput.vue_vue_type_script_setup_true_lang.83445eb1.js.map
