import{d as P,l as y,m as A,o as i,n as R,w as M,f as e,a as r,p as V,v as ee,s as F,L as te,x as G,y as K,H as oe,z as Q,r as se,c,F as j,i as ae,t as I,q as le,g as l,C as ne,b as ie,e as N,D as B,u as re,E as ce,G as de,h as me,I as ue}from"./index.2e7559f1.js";import{u as E,I as pe}from"./usePagedQuery.cc46e68d.js";import{I as fe}from"./trash.69394371.js";import{I as _e}from"./more-horizontal.f308c726.js";import{c as ve,U as he,T as ye,C as xe,d as ge}from"./graphql.3ddfc347.js";import{I as Te}from"./plus.17497381.js";const be={class:"flex flex-col space-y-4 relative"},ke={class:"flex flex-col relaive"},$e=e("label",{for:"teamName",class:"py-2"}," Team owner email ",-1),Ce={class:"flex flex-col"},we=e("label",{for:"teamName",class:"py-2"},"Team name",-1),De={class:"flex space-x-2"},Me=P({__name:"Add",props:{show:{type:Boolean,default:!1},loadingState:{type:Boolean,default:!1},allUsersEmail:null},emits:["hide-modal","create-team"],setup(v,{emit:a}){const d=Q(),m=y(""),u=y(""),T=o=>u.value=o,h=()=>{if(m.value.trim()===""){d.error("Please enter a valid team name");return}if(u.value.trim()===""){d.error("Please enter a valid owner email");return}a("create-team",m.value,u.value),m.value="",u.value=""},b=()=>{a("hide-modal")};return(o,n)=>{const p=te,_=G,H=K,L=oe,x=A("focus");return v.show?(i(),R(L,{key:0,dialog:"",title:"Create team",onClose:n[2]||(n[2]=f=>o.$emit("hide-modal"))},{body:M(()=>[e("div",be,[e("div",ke,[$e,r(p,{styles:"w-full p-2 bg-transparent border border-divider rounded-md ",class:"flex-1 !flex",source:v.allUsersEmail,spellcheck:!0,placeholder:"",onInput:n[0]||(n[0]=f=>T(f))},null,8,["source"])]),e("div",Ce,[we,V(e("input",{id:"teamName","onUpdate:modelValue":n[1]||(n[1]=f=>m.value=f),class:"input relative",placeholder:"",type:"email",autocomplete:"off"},null,512),[[ee,m.value],[x]])])])]),footer:M(()=>[e("span",De,[r(_,{label:"Create team",loading:v.loadingState,onClick:h},null,8,["loading"]),r(H,{label:"Cancel",outline:"",filled:"",onClick:b})])]),_:1})):F("",!0)}}}),He={class:"w-full"},Le=e("thead",null,[e("tr",{class:"text-secondary border-b border-dividerDark text-sm text-left"},[e("th",{class:"px-3 pb-3"},"Team ID"),e("th",{class:"px-3 pb-3"},"Team Name"),e("th",{class:"px-3 pb-3"},"Number of Members"),e("th",{class:"px-3 pb-3"})])],-1),Se={class:"divide-y divide-divider"},Ie={key:0},Pe=e("div",{class:"py-6 px-3"},"No teams found ...",-1),Ue=[Pe],Ne=["onClick"],Be={class:"flex"},Ee={class:"truncate"},Ae=["onClick"],Re={key:0,class:"flex items-center ml-4 truncate"},Ve={key:1,class:"flex items-center ml-4"},Fe=["onClick"],Ge={class:"ml-7"},Ke={class:"relative"},Qe=["onKeyup"],je=P({__name:"Table",props:{teamList:null},emits:["go-to-team-details","delete-team"],setup(v){const a=y(null);return(d,m)=>{const u=K,T=ne,h=se("tippy"),b=A("tippy");return i(),c("table",He,[Le,e("tbody",Se,[v.teamList.length===0?(i(),c("tr",Ie,Ue)):(i(!0),c(j,{key:1},ae(v.teamList,o=>{var n;return i(),c("tr",{key:o.id,class:"text-secondaryDark hover:bg-divider hover:cursor-pointer rounded-xl"},[e("td",{onClick:p=>d.$emit("go-to-team-details",o.id),class:"py-4 px-3 max-w-50"},[e("div",Be,[e("span",Ee,I(o.id),1)])],8,Ne),e("td",{onClick:p=>d.$emit("go-to-team-details",o.id),class:"py-4 px-3 min-w-80"},[o.name?(i(),c("span",Re,I(o.name),1)):(i(),c("span",Ve," (Unnamed team) "))],8,Ae),e("td",{onClick:p=>d.$emit("go-to-team-details",o.id),class:"py-4 px-3"},[e("span",Ge,I((n=o.members)==null?void 0:n.length),1)],8,Fe),e("td",null,[e("div",Ke,[r(h,{interactive:"",trigger:"click",theme:"popover"},{content:M(({hide:p})=>[e("div",{ref_for:!0,ref_key:"tippyActions",ref:a,class:"flex flex-col focus:outline-none",tabindex:"0",onKeyup:le(_=>p(),["escape"])},[r(T,{icon:l(fe),label:"Delete Team",class:"!hover:bg-red-600 w-full",onClick:()=>{d.$emit("delete-team",o.id),p()}},null,8,["icon","onClick"])],40,Qe)]),default:M(()=>[V(r(u,{icon:l(_e)},null,8,["icon"]),[[b,{theme:"tooltip"}]])]),_:2},1024)])])])}),128))])])}}}),qe={class:"flex flex-col"},ze=e("h1",{class:"text-lg font-bold text-secondaryDark"},"Teams",-1),Oe={class:"flex flex-col"},Je={class:"flex py-10"},We={class:"overflow-x-auto"},Xe={key:0,class:"flex justify-center"},Ye={key:1},Ze=e("span",null,"Show more ",-1),nt=P({__name:"index",setup(v){const a=Q(),{data:d}=ie({query:ve}),m=N(()=>{var t;return((t=d.value)==null?void 0:t.admin.usersCount)||1e4}),{list:u}=E(he,t=>t.admin.allUsers,t=>t.uid,m.value,{cursor:void 0,take:m.value}),T=N(()=>u.value.map(t=>t.email)),h=20,{fetching:b,error:o,goToNextPage:n,refetch:p,list:_,hasNextPage:H}=E(ye,t=>t.admin.allTeams,t=>t.id,h,{cursor:void 0,take:h}),L=B(xe),x=y(!1),f=y(!1),q=async(t,s)=>{var D;if(t.length<6){a.error("Team name should be atleast 6 characters long!!");return}if(s.length==0){a.error("Please enter email of team owner!!");return}f.value=!0;const $=((D=u.value.find(g=>g.email===s))==null?void 0:D.uid)||"",C={name:t.trim(),userUid:$};await L.executeMutation(C).then(g=>{g.error?(g.error.toString()=="[GraphQL] user/not_found"?a.error("User not found!!"):a.error("Failed to create team!!"),f.value=!1):(a.success("Team created successfully!!"),x.value=!1,f.value=!1,p())})},U=re(),z=t=>{U.push("/teams/"+t)},O=ce();de(()=>O.params.id,()=>window.location.reload());const J=B(ge),k=y(!1),S=y(null),W=t=>{k.value=!0,S.value=t},X=async t=>{if(!t){k.value=!1,a.error("Team deletion failed!!");return}const s={uid:t};await J.executeMutation(s).then($=>{$.error?a.error("Team deletion failed!!"):(_.value=_.value.filter(C=>C.id!==t),a.success("Team deleted successfully!!"))}),k.value=!1,S.value=null,U.push("/teams")};return(t,s)=>{const $=G,C=me,D=je,g=pe,Y=Me,Z=ue;return i(),c(j,null,[e("div",qe,[ze,e("div",Oe,[e("div",Je,[r($,{icon:l(Te),label:"Create team",onClick:s[0]||(s[0]=w=>x.value=!0)},null,8,["icon"])]),e("div",We,[l(b)&&!l(o)&&l(_).length===0?(i(),c("div",Xe,[r(C)])):l(o)?(i(),c("div",Ye,"Unable to Load Teams List..")):(i(),R(D,{key:2,teamList:l(_),onGoToTeamDetails:z,onDeleteTeam:W,class:""},null,8,["teamList"])),l(H)&&l(_).length>=h?(i(),c("div",{key:3,class:"flex justify-center my-5 px-3 py-2 cursor-pointer font-semibold rounded-3xl bg-dividerDark hover:bg-divider transition mx-auto w-38 text-secondaryDark",onClick:s[1]||(s[1]=(...w)=>l(n)&&l(n)(...w))},[Ze,r(g,{class:"ml-2 text-lg"})])):F("",!0)])])]),r(Y,{show:x.value,allUsersEmail:l(T),"loading-state":f.value,onHideModal:s[2]||(s[2]=w=>x.value=!1),onCreateTeam:q},null,8,["show","allUsersEmail","loading-state"]),r(Z,{show:k.value,title:"Confirm Deletion of the team?",onHideModal:s[3]||(s[3]=w=>k.value=!1),onResolve:s[4]||(s[4]=w=>X(S.value))},null,8,["show"])],64)}}});export{nt as default};
