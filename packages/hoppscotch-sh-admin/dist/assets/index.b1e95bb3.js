import{d as P,l as y,m as E,o as l,n as I,w as T,f as e,p as F,q as K,v as ne,a as u,s as C,x as V,y as R,H as ie,z as j,c as d,r as ae,F as le,i as re,t as A,k as de,g as a,A as ce,B as ue,C as me,_ as pe,D as M,E as ve,u as _e,G as fe,h as he,I as ye}from"./index.2e7559f1.js";import{u as xe,I as ke}from"./usePagedQuery.cc46e68d.js";import{I as Ue}from"./trash.69394371.js";import{I as ge}from"./user-minus.c61c28a5.js";import{I as $e}from"./more-horizontal.f308c726.js";import{f as L}from"./index.a5da96cc.js";import{U as be,a as we,R as De,M as Ae,b as Ie}from"./graphql.3ddfc347.js";import{I as Ce}from"./user-plus.0738aef0.js";const Me={class:"flex flex-col"},Te=["onKeyup"],Se=e("label",{for:"inviteUserEmail"},"Email Address",-1),He={class:"flex space-x-2"},Be=P({__name:"InviteModal",props:{show:{type:Boolean,default:!1},loadingState:{type:Boolean,default:!1}},emits:["hide-modal","send-invite"],setup(p,{emit:n}){const k=j(),_=y(""),i=()=>{if(_.value.trim()===""){k.error("Please enter a valid email address");return}n("send-invite",_.value)},U=()=>{n("hide-modal")};return(r,v)=>{const g=V,x=R,o=ie,c=E("focus");return p.show?(l(),I(o,{key:0,dialog:"",title:"Invite User",onClose:v[1]||(v[1]=$=>r.$emit("hide-modal"))},{body:T(()=>[e("div",Me,[F(e("input",{id:"inviteUserEmail","onUpdate:modelValue":v[0]||(v[0]=$=>_.value=$),class:"input floating-input",placeholder:" ",type:"text",autocomplete:"off",onKeyup:K(i,["enter"])},null,40,Te),[[ne,_.value],[c]]),Se])]),footer:T(()=>[e("span",He,[u(g,{label:"Send Invite",loading:p.loadingState,onClick:i},null,8,["loading"]),u(x,{label:"Cancel",outline:"",filled:"",onClick:U})])]),_:1})):C("",!0)}}}),Ne={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pe=e("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[e("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e("circle",{cx:"9",cy:"7",r:"4"}),e("path",{d:"m16 11l2 2l4-4"})],-1),Re=[Pe];function Le(p,n){return l(),d("svg",Ne,Re)}const Ee={name:"lucide-user-check",render:Le},z=p=>(ce("data-v-995382a7"),p=p(),ue(),p),Fe={class:"w-full"},Ke=z(()=>e("thead",null,[e("tr",{class:"text-secondary border-b border-dividerDark text-sm text-left"},[e("th",{class:"px-3 pb-3"},"User ID"),e("th",{class:"px-3 pb-3"},"Name"),e("th",{class:"px-3 pb-3"},"Email"),e("th",{class:"px-3 pb-3"},"Date"),e("th",{class:"px-3 pb-3"})])],-1)),Ve={class:"divide-y divide-divider"},je=["onClick"],ze={class:"flex"},Ge={class:"truncate"},Oe=["onClick"],qe={key:0,class:"flex items-center space-x-3"},Qe={key:0,class:"text-xs font-medium px-3 py-0.5 rounded-full bg-green-900 text-green-300"},Ye={key:1,class:"flex items-center space-x-3"},Je=z(()=>e("span",null," (Unnamed user) ",-1)),We={key:0,class:"text-xs font-medium px-3 py-0.5 rounded-full bg-green-900 text-green-300"},Xe=["onClick"],Ze=["onClick"],et={class:"flex items-center"},tt={class:"flex flex-col"},st={class:"text-gray-400 text-tiny"},ot={class:"relative"},nt=["onKeyup"],it=P({__name:"Table",props:{usersList:null},emits:["goToUserDetails","makeUserAdmin","makeAdminToUser","deleteUser"],setup(p){const n=i=>L(new Date(i),"dd-MM-yyyy"),k=i=>L(new Date(i),"hh:mm a"),_=y(null);return(i,U)=>{const r=R,v=me,g=ae("tippy"),x=E("tippy");return l(),d("table",Fe,[Ke,e("tbody",Ve,[(l(!0),d(le,null,re(p.usersList,o=>(l(),d("tr",{key:o.uid,class:"text-secondaryDark hover:bg-divider hover:cursor-pointer rounded-xl"},[e("td",{onClick:c=>i.$emit("goToUserDetails",o.uid),class:"py-2 px-3 max-w-30"},[e("div",ze,[e("span",Ge,A(o.uid),1)])],8,je),e("td",{onClick:c=>i.$emit("goToUserDetails",o.uid),class:"py-2 px-3"},[o.displayName?(l(),d("div",qe,[e("span",null,A(o.displayName),1),o.isAdmin?(l(),d("span",Qe," Admin ")):C("",!0)])):(l(),d("div",Ye,[Je,o.isAdmin?(l(),d("span",We," Admin ")):C("",!0)]))],8,Oe),e("td",{onClick:c=>i.$emit("goToUserDetails",o.uid),class:"py-2 px-3"},[e("span",null,A(o.email),1)],8,Xe),e("td",{onClick:c=>i.$emit("goToUserDetails",o.uid),class:"py-2 px-3"},[e("div",et,[e("div",tt,[de(A(n(o.createdOn))+" ",1),e("div",st,A(k(o.createdOn)),1)])])],8,Ze),e("td",null,[e("div",ot,[e("span",null,[u(g,{interactive:"",trigger:"click",theme:"popover"},{content:T(({hide:c})=>[e("div",{ref_for:!0,ref_key:"tippyActions",ref:_,class:"flex flex-col focus:outline-none",tabindex:"0",onKeyup:K($=>c(),["escape"])},[o.isAdmin?(l(),I(v,{key:1,icon:a(ge),label:"Remove Admin Status",class:"!hover:bg-emerald-600",onClick:()=>{i.$emit("makeAdminToUser",o.uid),c()}},null,8,["icon","onClick"])):(l(),I(v,{key:0,icon:a(Ee),label:"Make Admin",class:"!hover:bg-emerald-600",onClick:()=>{i.$emit("makeUserAdmin",o.uid),c()}},null,8,["icon","onClick"])),o.isAdmin?C("",!0):(l(),I(v,{key:2,icon:a(Ue),label:"Delete User",class:"!hover:bg-red-600",onClick:()=>{i.$emit("deleteUser",o.uid),c()}},null,8,["icon","onClick"]))],40,nt)]),default:T(()=>[F(u(r,{icon:a($e)},null,8,["icon"]),[[x,{theme:"tooltip"}]])]),_:2},1024)])])])]))),128))])])}}});const at=pe(it,[["__scopeId","data-v-995382a7"]]),lt={class:"flex flex-col"},rt={class:"flex flex-col"},dt=e("h1",{class:"text-lg font-bold text-secondaryDark"},"Users",-1),ct={class:"flex items-center space-x-4 py-10"},ut={class:"flex"},mt={class:"overflow-x-auto"},pt={key:0,class:"flex justify-center"},vt={key:1},_t={key:3,class:"flex justify-center"},ft=e("span",null,"Show more ",-1),wt=P({__name:"index",setup(p){const n=j(),k=20,{fetching:_,error:i,goToNextPage:U,list:r,hasNextPage:v}=xe(be,t=>t.admin.allUsers,t=>t.uid,k,{cursor:void 0,take:k}),g=M(we),x=y(!1),o=async t=>{if(!t.trim()){n.error("Please enter a valid email address");return}const s={inviteeEmail:t.trim()};await g.executeMutation(s).then(f=>{f.error?n.error("Failed to send invitation"):(n.success("Email invitation sent successfully"),x.value=!1)})},c=ve(),$=_e(),G=t=>{$.push("/users/"+t)};fe(()=>c.params.id,()=>window.location.reload());const O=M(De),b=y(!1),S=y(null),q=async t=>{if(!t){b.value=!1,n.error("User deletion failed!!");return}const s={uid:t};await O.executeMutation(s).then(f=>{f.error?n.error("User deletion failed!!"):(n.success("User deleted successfully!!"),r.value=r.value.filter(m=>m.uid!==t))}),b.value=!1,S.value=null},Q=M(Ae),w=y(!1),H=y(null),Y=t=>{w.value=!0,H.value=t},J=async t=>{if(!t){w.value=!1,n.error("Failed to make user an admin!!");return}const s={uid:t};await Q.executeMutation(s).then(f=>{f.error?n.error("Failed to make user an admin!!"):(n.success("User is now an admin!!"),r.value=r.value.map(m=>(m.uid===t&&(m.isAdmin=!0),m)))}),w.value=!1,H.value=null},W=M(Ie),D=y(!1),B=y(null),X=t=>{D.value=!0,B.value=t},Z=t=>{b.value=!0,S.value=t},ee=async t=>{if(!t){D.value=!1,n.error("Failed to remove admin status!!");return}const s={uid:t};await W.executeMutation(s).then(f=>{f.error?n.error("Failed to remove admin status!!"):(n.success("Admin status removed!!"),r.value=r.value.map(m=>(m.uid===t&&(m.isAdmin=!1),m)))}),D.value=!1,B.value=null};return(t,s)=>{const f=V,m=he,te=at,se=ke,oe=Be,N=ye;return l(),d("div",lt,[e("div",rt,[dt,e("div",ct,[u(f,{label:"Invite a user",onClick:s[0]||(s[0]=h=>x.value=!0),icon:a(Ce)},null,8,["icon"]),e("div",ut,[u(a(R),{outline:"",filled:"",label:"Invited users",to:"/users/invited"})])]),e("div",mt,[a(_)&&!a(i)&&a(r).length===0?(l(),d("div",pt,[u(m)])):a(i)?(l(),d("div",vt,"Unable to Load Users List..")):a(r).length>=1?(l(),I(te,{key:2,usersList:a(r),fetching:a(_),error:a(i),onGoToUserDetails:G,onMakeUserAdmin:Y,onMakeAdminToUser:X,onDeleteUser:Z},null,8,["usersList","fetching","error"])):(l(),d("div",_t,"No Users Found")),a(v)&&a(r).length>=k?(l(),d("div",{key:4,class:"flex justify-center my-5 px-3 py-2 cursor-pointer font-semibold rounded-3xl bg-dividerDark hover:bg-divider transition mx-auto w-38 text-secondaryDark",onClick:s[1]||(s[1]=(...h)=>a(U)&&a(U)(...h))},[ft,u(se,{class:"ml-2 text-lg"})])):C("",!0)])]),u(oe,{show:x.value,onHideModal:s[2]||(s[2]=h=>x.value=!1),onSendInvite:o},null,8,["show"]),u(N,{show:b.value,title:"Confirm user deletion?",onHideModal:s[3]||(s[3]=h=>b.value=!1),onResolve:s[4]||(s[4]=h=>q(S.value))},null,8,["show"]),u(N,{show:w.value,title:"Do you want to make this user into an admin?",onHideModal:s[5]||(s[5]=h=>w.value=!1),onResolve:s[6]||(s[6]=h=>J(H.value))},null,8,["show"]),u(N,{show:D.value,title:"Do you want to remove admin status from this user?",onHideModal:s[7]||(s[7]=h=>D.value=!1),onResolve:s[8]||(s[8]=h=>ee(B.value))},null,8,["show"])])}}});export{wt as default};
